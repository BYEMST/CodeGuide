---
title: ç¬¬2-16èŠ‚ï¼šfix-å¤šæ¨¡æ€èƒ½åŠ›ä½¿ç”¨
pay: https://t.zsxq.com/a8AJj
---

# ã€ŠAI Agent è„šæ‰‹æ¶ã€‹ç¬¬2-16èŠ‚ï¼šfix-å¤šæ¨¡æ€èƒ½åŠ›ä½¿ç”¨

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>è§†é¢‘ï¼š[å¾…æ›´æ–°](#)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€æœ¬ç« è¯‰æ±‚

ä¸ºæ¥å…¥ Google ADK çš„ Spring AI æä¾›å›¾ç‰‡è¯†åˆ«çš„å¤šæ¨¡æ€èƒ½åŠ›ã€‚

è¿™æœ¬åº”è¯¥æ˜¯ä¸€ä¸ªç®€å•ç›´æ¥ä½¿ç”¨çš„åŠŸèƒ½ï¼Œä½†åœ¨ `Google ADK 0.5.0`ã€`Spring AI 1.1.0` ç‰ˆæœ¬ä¸Šï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªéšè—å¾…å¤„ç†çš„ Bugï¼Œå°å‚…å“¥å·²äº 2026å¹´1æœˆ6æ—¥ï¼Œæäº¤ [https://github.com/google/adk-java/issues/705](https://github.com/google/adk-java/issues/705)

Google ADK Java å¼€å‘å·¥ç¨‹å¸ˆï¼Œåœ¨ 2026å¹´1æœˆ7æ—¥ï¼Œå¤„ç†æäº¤äº†ä¿®å¤ä»£ç ï¼Œåº”è¯¥ä¼šåœ¨åç»­ç‰ˆæœ¬æ›´æ–°ã€‚

ä¸è¿‡ï¼Œå¯¹äºæˆ‘ä»¬å­¦ä¹ æ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯åäº‹ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™æ ·çš„é—®é¢˜ç‚¹ï¼Œæ·±å…¥ç†è§£ Google ADK å’Œ Spring AI çš„å¯¹æ¥ï¼Œä»¥åŠå­¦ä¹ å¦‚ä½•æ’æŸ¥è¿™æ ·çš„æŠ¥é”™ã€‚æœ€ç»ˆï¼Œé‰´äº Google ADK ç‰ˆæœ¬æ›´æ–°å‘¨æœŸï¼Œæˆ‘ä»¬ç›®å‰å…ˆåœ¨ç¨‹åºä¸­æ‰“ä¸€ä¸ªâ€è¡¥ä¸â€œå®ç°ã€‚

## äºŒã€å‘ç°é—®é¢˜

### æ­¥éª¤1ï¼ŒåŠŸèƒ½è¯‰æ±‚

```java
@Test
public void test_handlerMessage_03() throws IOException {
    AiAgentRegisterVO aiAgentRegisterVO = applicationContext.getBean("100003", AiAgentRegisterVO.class);
   
   String appName = aiAgentRegisterVO.getAppName();
    InMemoryRunner runner = aiAgentRegisterVO.getRunner();
    Session session = runner.sessionService()
            .createSession(appName, "xiaofuge")
            .blockingGet();
            
    Content userMsg = Content.fromParts(Part.fromText("è¿™æ˜¯ä»€ä¹ˆå›¾ç‰‡ï¼Ÿ"),
            Part.fromBytes(imageResource.getContentAsByteArray(), MimeTypeUtils.IMAGE_PNG_VALUE));
            
    Flowable<Event> events = runner.runAsync("xiaofuge", session.id(), userMsg);
    
    List<String> outputs = new ArrayList<>();
    events.blockingForEach(event -> outputs.add(event.stringifyContent()));
    log.info("æµ‹è¯•ç»“æœ:{}", JSON.toJSONString(outputs));
}
```

<div align="center">
	<img src="https://bugstack.cn/images/article/project/ai-agent-scaffold/part-2/2-16/images/ai-agent-scaffold-2-16-01.png" width="950px"/>
</div>

- åœ¨æ–°çš„ç« èŠ‚ï¼Œéœ€è¦éªŒè¯å¤šæ¨¡æ€èƒ½åŠ›çš„æ—¶å€™ï¼Œä¼ å…¥äº†ä¸€ä¸ªå›¾ç‰‡ byteï¼Œä½†æ— è®ºå¦‚ä½•ä¿®æ”¹è¿è¡Œï¼Œéƒ½åªæ˜¯æç¤ºæ— æ³•è¯†åˆ«å›¾ç‰‡ã€‚
- è¿™ä¸ªæ—¶å€™çŒœæƒ³ï¼Œæ˜¯ä¸æ˜¯ InMemoryRunner æ„å»ºé—®é¢˜ï¼Œæˆ–è€… Agent å®ä¾‹åŒ–å‚æ•°é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå†³å®šæŠŠé—®é¢˜ç¼©å°ï¼Œå•ç‹¬éªŒè¯ Google ADK + Spring AIã€‚

### æ­¥éª¤2ï¼Œåˆ†å—éªŒè¯

```java
@Slf4j
public class SpringAiTest {

    @SneakyThrows
    public static void main(String[] args) {

        OpenAiApi openAiApi = OpenAiApi.builder()
                .baseUrl("https://apis.itedus.cn")
                .apiKey("sk-2GQTYTNoQSs7qizlE9F00bD84d254c2994D44d6410B0Ac8f")
                .completionsPath("v1/chat/completions")
                .embeddingsPath("v1/embeddings")
                .build();

        ChatModel chatModel = OpenAiChatModel.builder()
                .openAiApi(openAiApi)
                .defaultOptions(OpenAiChatOptions.builder()
                        .model("gpt-4.1")
                        .build())
                .build();

        LlmAgent agent = LlmAgent.builder()
                .name("test")
                .description("Chess coach agent")
                .model(new SpringAI(chatModel))
                .instruction("""
                        You are a knowledgeable chess coach
                        who helps chess players train and sharpen their chess skills.
                        """)
                .build();

        InMemoryRunner runner = new InMemoryRunner(agent);

        Session session = runner
                .sessionService()
                .createSession("test", "xiaofuge")
                .blockingGet();

        URL resource = Thread.currentThread().getContextClassLoader().getResource("dog.png");

        byte[] bytes;
        assert resource != null;
        try (InputStream inputStream = resource.openStream()) {
            bytes = inputStream.readAllBytes();
        }

        List<Part> parts = new ArrayList<>();
        parts.add(Part.fromText("è¿™æ˜¯ä»€ä¹ˆå›¾ç‰‡"));
        parts.add(Part.fromBytes(bytes, MimeTypeUtils.IMAGE_PNG_VALUE));

        Content content = Content.builder().role("user").parts(parts).build();

        Flowable<Event> events = runner.runAsync("xiaofuge", session.id(),
                content
        );

        System.out.print("\nAgent > ");
        events.blockingForEach(event -> System.out.println(event.stringifyContent()));
    }

}
```

- æ•ˆæœï¼›è¿è¡Œç»“æœä¾ç„¶æ˜¯è¯†åˆ«ä¸äº†ï¼Œå‘Šè¯‰æˆ‘è¦ä¸Šä¼ å›¾ç‰‡ï¼Œå®ƒæ‰èƒ½è¯†åˆ«ã€‚
- çŒœæƒ³ï¼›è¿™è¯´æ˜å•ç‹¬æŒ‰ç…§å®˜ç½‘æ¡ˆä¾‹æ„å»º Agent å¹¶æµ‹è¯•ä¾ç„¶ä¸è¡Œï¼Œå†ç»†åŒ–éªŒè¯ã€‚

### æ­¥éª¤3ï¼Œå•ä¸ªåŠŸèƒ½

```java
import com.alibaba.fastjson.JSON;
import com.google.adk.agents.LlmAgent;
import com.google.adk.events.Event;
import com.google.adk.models.springai.SpringAI;
import com.google.adk.runner.InMemoryRunner;
import com.google.adk.sessions.Session;
import com.google.genai.types.Content;
import com.google.genai.types.Part;
import io.reactivex.rxjava3.core.Flowable;
import org.springframework.ai.chat.messages.UserMessage;
import org.springframework.ai.chat.model.ChatModel;
import org.springframework.ai.chat.model.ChatResponse;
import org.springframework.ai.chat.prompt.Prompt;
import org.springframework.ai.content.Media;
import org.springframework.ai.openai.OpenAiChatModel;
import org.springframework.ai.openai.OpenAiChatOptions;
import org.springframework.ai.openai.api.OpenAiApi;

import org.springframework.core.io.ClassPathResource;
import org.springframework.core.io.Resource;
import org.springframework.util.MimeType;
import org.springframework.util.MimeTypeUtils;

import java.io.InputStream;

public class SpringAiApiTest {

    public static void main(String[] args) throws Exception {
        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
        InputStream resourceAsStream = classLoader.getResourceAsStream("dog.png");
        Resource resource = new ClassPathResource("dog.png", classLoader);
        assert resourceAsStream != null;

        OpenAiApi openAiApi = OpenAiApi.builder()
                .baseUrl("https://apis.xxx")
                .apiKey("sk-zahsFUzQcpOauNQUD3918eEe95194d...*****")
                .completionsPath("v1/chat/completions")
                .embeddingsPath("v1/embeddings")
                .build();

        ChatModel chatModel = OpenAiChatModel.builder()
                .openAiApi(openAiApi)
                .defaultOptions(OpenAiChatOptions.builder()
                        .model("gpt-4o")
                        .build())
                .build();

        // æ¨¡å‹æµ‹è¯•ï¼Œæ²¡é—®é¢˜å¯ä»¥è¯†åˆ«å›¾ç‰‡
        ChatResponse response = chatModel.call(new Prompt(
                UserMessage.builder()
                        .text("è¯·æè¿°è¿™å¼ å›¾ç‰‡çš„ä¸»è¦å†…å®¹ï¼Œå¹¶è¯´æ˜å›¾ä¸­ç‰©å“çš„å¯èƒ½ç”¨é€”ã€‚")
                        .media(Media.builder()
                                .mimeType(MimeType.valueOf(MimeTypeUtils.IMAGE_PNG_VALUE))
                                .data(resource)
                                .build())
                        .build(),
                OpenAiChatOptions.builder()
                        .model("gpt-4o")
                        .build()));

        System.out.println("æµ‹è¯•ç»“æœ" + JSON.toJSONString(response));

    }

}

```

<div align="center">
	<img src="https://bugstack.cn/images/article/project/ai-agent-scaffold/part-2/2-16/images/ai-agent-scaffold-2-16-02.png" width="950px"/>
</div>

- æ•ˆæœï¼›ç›´æ¥ç”¨ Spring AI åŸæœ‰çš„åŠŸèƒ½è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯é€šè¿‡ï¼Œå¯ä»¥è¯†åˆ«å›¾ç‰‡ã€‚
- çŒœæƒ³ï¼›å¤§æ¦‚ç‡æ˜¯ Google ADK å’Œ Spring AI å¯¹æ¥çš„é—®é¢˜ï¼Œéœ€è¦debugè°ƒè¯•éªŒè¯ï¼Œæ‰¾åˆ°å¯¹æ¥ç‚¹çš„å‚æ•°ä¼ é€’ã€‚

### æ­¥éª¤4ï¼Œå‡çº§æ¡†æ¶

```java
<google.adk.version>0.5.0</google.adk.version>

<dependency>
    <groupId>com.google.adk</groupId>
    <artifactId>google-adk-spring-ai</artifactId>
    <version>${google.adk.version}</version>
</dependency>
```

- å‡çº§æ¡†æ¶åˆ° 0.5.0 ç‰ˆæœ¬ï¼Œä¾ç„¶ä¸è¡Œã€‚

### æ­¥éª¤4ï¼Œæ‰¾åˆ°é—®é¢˜

<div align="center">
	<img src="https://bugstack.cn/images/article/project/ai-agent-scaffold/part-2/2-16/images/ai-agent-scaffold-2-16-03.png" width="950px"/>
</div>

- å½“ Debug åˆ° MessageConverter æ¶ˆæ¯è½¬æ¢çš„æ—¶å€™å‘ç°ï¼Œå®ƒå‹æ ¹å°±æ²¡å¤„ç†å›¾ç‰‡ç±»çš„ä¸œè¥¿ï¼Œå†™äº†ä¸ª TODOã€‚
- **é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œå°å‚…å“¥å†å¸¦ç€å¤§å®¶çœ‹ä¸‹ï¼Œè¿™æ ·çš„é—®é¢˜æ€ä¹ˆæ’æŸ¥ã€‚**