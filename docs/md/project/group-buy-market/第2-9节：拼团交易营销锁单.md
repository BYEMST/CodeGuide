---
title: 【更】第2-8节：第2-9节：拼团交易营销锁单
pay: https://t.zsxq.com/csVlH
---

# 《拼团交易平台系统》第2-9节：拼团交易营销锁单

作者：小傅哥
<br/>博客：[https://bugstack.cn](https://bugstack.cn)
<br/>视频：[https://t.zsxq.com/csVlH](https://t.zsxq.com/csVlH)

> 沉淀、分享、成长，让自己和他人都能有所收获！😄

大家好，我是技术UP主小傅哥。

在编程开发实现业务逻辑的过程中，头脑中可以有一个乐高积木的思想，考虑分拆逻辑聚合每一块业务。让这些业务具备良好的复用性。

尤其是复杂的下单过程，会有很多模块会被使用，所以这部分要想好你在整个下单过程中，会有哪些逻辑应该被聚合，怎么串联上下文。

## 一、本章诉求

当商城类系统接入拼团时，则需要在下单过程中使用一笔营销优惠。这里的营销优惠可以为；无券平台营销、有券消费营销、拼团折扣营销、积分抵扣营销等。

那么，当商城类系统接入使用下单时，则需要到拼团系统锁定一笔优惠，也就是占用一个名额。完事后，商城类系统继续操作支付交易的过程。

## 二、业务流程

如图，完善原有业务流程。

<div align="center">
    <img src="https://bugstack.cn/images/article/project/group-buy-market/group-buy-market-2-9-01.png" width="850px">
</div>

- 首先，团购的商品下单。下单过程分为创建流水单、锁定营销优惠（拼团、积分、券）、创建支付订单、唤起收银台支付、用户扫码支付、支付完成核销优惠等。
- 那么，这里用户以拼团方式下单，创建流水单完成后，需要与拼团系统交互，锁定营销优惠。更新流水单优惠金额和支付金额。接下来就可以创建支付单了（支付单需要最终的支付金额）。
- 注意，拼团表 group_buy_order 除了有目标量（target_count）、完成量（complete），还要有一个锁单量（lock_count），当锁单量达到目标量后，用户在此组织下，不能在参与拼团。直至这些用户支付完成达成拼团或者锁单超时回退支付营销，空出可参与锁单量，这样其他用户可以继续参与。