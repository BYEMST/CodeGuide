---
title: 【更】第2-12节：拼团组队结算统计
pay: https://t.zsxq.com/OvyY1
---

# 《拼团交易平台系统》第2-12节：人群标签生成任务

作者：小傅哥
<br/>博客：[https://bugstack.cn](https://bugstack.cn)
<br/>视频：[https://t.zsxq.com/89N6w](https://t.zsxq.com/89N6w)

> 沉淀、分享、成长，让自己和他人都能有所收获！😄

大家好，我是技术UP主小傅哥。

其实互联网大厂也是从草蜢阶段过来的，所以到现在才有这么大的技术债。几乎每年我们都要为工程制定体系化建设的计划，新的工程采用纯心的架构模型实现，旧的工程分为重构计划和工程内编码治理。

通过这样的手段，让工程一点点从严重的腐化中拆解出来。所以你在学习咱们的新项目时候，也会感受到不断的抽象和治理，让代码变得容易被理解和迭代。

## 一、本章诉求

首先，你可以回忆下咱们整个拼团业务的流程。

拼团的过程是用户在商城下单，锁定拼团优惠（也就是拼团系统里锁单的过程）。之后就是用户给这笔商品完成支付交易，交易后不会直接发货，直至拼团组队完成后才会发货。

那么，这里有一个流程，就是支付完成后，需要做拼团数量的统计结算。如，拼团需要3个用户一起下单，那么每完成一笔支付，就要给拼团的组队加上一笔记录。这个就是本节要实现的流程。

## 二、业务流程

如图，拼团结算流程。

<div align="center">
    <img src="https://bugstack.cn/images/article/project/group-buy-market/group-buy-market-2-12-01.png" width="550px">
</div>

- 首先，交易订单的营销结算，核心就是更新拼团队伍的参与人数数量。每完成一笔支付，就有一笔拼团进度数量+1。
- 之后，这里要知道，更新拼团订单的明细状态（交易完成）和更新拼团进度数量要在一个事务下完成。
- 另外，更新拼团的进度要判断，当前是否为最后一次拼团完结状态。比如计算剩余1个，即可完成拼团目标量，那么这最后一笔更新完成后，既是整个拼团队伍的进度完成了。